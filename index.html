<!DOCTYPE html>
<html style="font-family: Roboto, Arial, sans-serif;">
<head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="description" content="32 Tshiok game.">
    <link rel="stylesheet" type="text/css" href="styles/basics.css" />
    <link rel="stylesheet" type="text/css" href="styles/squares.css" />
<title>32 Tshiok</title>
<link rel="shortcut icon" href="images/chiweg.svg">
</head>
<style>
    a:link { color: #0000EE; }
    a:visited { color: #551A8B; }
    /* * {color: #1f2328} */
</style>
<body style="margin:0; overflow: hidden; background-color: #999;" onclick="Bodyplaybgm()">
<audio id="bgm" src="sounds/dòu nǎng yěn lyỳ chiwěg̏.mp3" loop></audio>
<div id="box" class="fixed">
    <div id="title" style="visibility: visible;">
        <img src="images/logo.svg" style="filter: drop-shadow(0 0 0.0015rem #fff); position: absolute; left: 20%; top: 5%; width: 60%;">
        <div class="chardis" id="cd0" data-you="1" onclick="ChangeYou(0)" style="right: calc(69.5% + 0.0064rem);"><div class="shadow"></div><img src="images/puan.svg" style="width:133%; top: -1%; left: -30%;"><p><i><b style="font-size: 0.0315rem; color: #000; position: absolute; bottom: 0; left: 0.035rem; width: 0.1rem">puān</b></i></p><p class="you">You</p><input type="checkbox" onclick="CheckCharacter(event)" id="cb0" checked></div>
        <div class="chardis" id="cd1" data-you="0" onclick="ChangeYou(1)" style="right: 51.5%;"><div class="shadow"></div><img src="images/chyung.svg" style="width:97.5%; top: -6%; left: 2%;"><p><i><b style="font-size: 0.0315rem; color: #000; position: absolute; bottom: 0; left: 0.0336rem; width: 0.115rem">chyúng</b></i></p><p class="you">You</p><input type="checkbox" onclick="CheckCharacter(event)" id="cb1" checked></div>
        <div class="chardis" id="cd2" data-you="0" onclick="ChangeYou(2)" style="left: 51.5%;"><div class="shadow"></div><img src="images/zra.svg" style="width:99%; top: 0; left: 0.5%;"><p><i><b style="font-size: 0.0315rem; color: #000; position: absolute; bottom: 0; left: 0.035rem; width: 0.1rem">zrả</b></i></p><p class="you">You</p><input type="checkbox" onclick="CheckCharacter(event)" id="cb2" checked></div>
        <div class="chardis" id="cd3" data-you="0" onclick="ChangeYou(3)" style="left: calc(69.5% + 0.0064rem);"><div class="shadow"></div><img src="images/cnai.svg" style="width:105%; top: -1%; left: -1%;"><p><i><b style="font-size: 0.0315rem; color: #000; position: absolute; bottom: 0; left: 0.0336rem; width: 0.1rem">cnāi</b></i></p><p class="you">You</p><input type="checkbox" onclick="CheckCharacter(event)" id="cb3" checked></div>
        <p id="playercount" style="position: absolute; text-align: center; left: 0; top: 73.5%; width: 100%; height: 20%; font-size: 0.05rem; color: #eee;">4 Players</p>
        <button onclick="START()" style="position: absolute; left: 37.5%; top: 85%; width: 25%; height: 12%; font-size: 0.05rem;">START</button>
        <p style="color: #000; font-size: 0.02rem; position: absolute; bottom: 0.001rem; left: 0.001rem">lì tŕ 2024<br>yowwowwow.github.io</p>
    </div>
    <div id="game" style="visibility: hidden;">
        <button onclick="QUIT()" style="position: absolute; left: 0.5625%; top: 1%; width: 11%; height: 8%; font-size: 0.035rem;">QUIT</button>
        <div id="field" style="position: absolute; width: 45%; height: 40%; top: 22.5%; left: 27.5%;"><div class="sq" data-val="-1" data-pos="0"></div><div class="sq" data-val="-1" data-pos="1"></div><div class="sq" data-val="-1" data-pos="2"></div><div class="sq" data-val="-1" data-pos="3"></div><div class="sq" data-val="-1" data-pos="4"></div><div class="sq" data-val="-1" data-pos="5"></div><div class="sq" data-val="-1" data-pos="6"></div><div class="sq" data-val="-1" data-pos="7"></div><div class="sq" data-val="-1" data-pos="8"></div><div class="sq" data-val="-1" data-pos="9"></div><div class="sq" data-val="-1" data-pos="10"></div><div class="sq" data-val="-1" data-pos="11"></div><div class="sq" data-val="-1" data-pos="12"></div><div class="sq" data-val="-1" data-pos="13"></div><div class="sq" data-val="-1" data-pos="14"></div><div class="sq" data-val="-1" data-pos="15"></div><div class="sq" data-val="-1" data-pos="16"></div><div class="sq" data-val="-1" data-pos="17"></div><div class="sq" data-val="-1" data-pos="18"></div><div class="sq" data-val="-1" data-pos="19"></div><div class="sq" data-val="-1" data-pos="20"></div><div class="sq" data-val="-1" data-pos="21"></div><div class="sq" data-val="-1" data-pos="22"></div><div class="sq" data-val="-1" data-pos="23"></div><div class="sq" data-val="-1" data-pos="24"></div><div class="sq" data-val="-1" data-pos="25"></div><div class="sq" data-val="-1" data-pos="26"></div><div class="sq" data-val="-1" data-pos="27"></div><div class="sq" data-val="-1" data-pos="28"></div><div class="sq" data-val="-1" data-pos="29"></div><div class="sq" data-val="-1" data-pos="30"></div><div class="sq" data-val="-1" data-pos="31"></div></div>
        <div class="head" id="phead" data-val="3" style="left: 15%; bottom: 17%;"><div class="shadow"></div><img src="images/cnai head.svg"></div>
        <div class="head" id="head1" data-val="3" style="right: 1%; bottom: 20%;"><div class="shadow"></div><img src="images/cnai head.svg"></div>
        <div class="head" id="head2" data-val="3" style="right: 15%; top: 1%;"><div class="shadow"></div><img src="images/cnai head.svg"></div>
        <div class="head" id="head3" data-val="3" style="left: 1%; top: 10%;"><div class="shadow"></div><img src="images/cnai head.svg"></div>
        <p style="color: #000; font-size: 0.02rem; position: absolute; left: 24%; bottom: 16.8%;">You</p>
        <p class="wind" id="pwind" style="left: 24.75%; bottom: 21.5%;"><ruby style="color: #faa">東<rt>east</rt></ruby></p>
        <p class="wind" id="wind1" style="right: 6%; bottom: 36.5%;"><ruby>南<rt>south</rt></ruby></p>
        <p class="wind" id="wind2" style="right: 24.75%; top: 8.7%;"><ruby>西<rt>west</rt></ruby></p>
        <p class="wind" id="wind3" style="left: 6%; top: 26.25%;"><ruby>北<rt>north</rt></ruby></p>
        <p id="infostr" style="left: 0.25%; bottom: 0.1%;"><ruby>東<rt>east</rt></ruby>1<ruby>連<rt>streak</rt>0<ruby>流<rt>draws</rt>0</p>
        <p class="score" id="pscore" style="left: 29%; bottom: 21.5%;">30000</p>
        <p class="score" id="score1" style="right: 6%; bottom: 45%;">30000</p>
        <p class="score" id="score2" style="right: 29%; top: 8.7%;">30000</p>
        <p class="score" id="score3" style="left: 6%; top: 34.75%;">30000</p>
        <div class="moves" style="position: absolute; width: 35%; height: 15%; right: 14%; bottom: 17%;">
            <button disabled id="m0" onclick="MoveButton(0)" style="left: 0.5005%; bottom: 0.2145%;"><ruby>Chow<rt>吃</rt></ruby></button>
            <button disabled id="m1" onclick="MoveButton(1)" style="left: 0.5005%; top: 0.2145%;"><ruby>Pong<rt>碰</rt></ruby></button>
            <button disabled id="m2" onclick="MoveButton(2)" style="left: 25.5005%; bottom: 0.2145%;"><ruby>Kong<rt>槓</rt></ruby></button>
            <button disabled id="m3" onclick="MoveButton(3)" style="left: 25.5005%; top: 0.2145%;"><ruby>Riichi<rt>聽</rt></ruby></button>
            <button disabled id="m4" onclick="MoveButton(4)" style="left: 50.5005%; bottom: 0.2145%;"><ruby>Win<rt>胡</rt></ruby></button>
            <button disabled id="m5" onclick="MoveButton(5)" style="left: 50.5005%; top: 0.2145%; font-size: 0.015rem; text-wrap: nowrap;"><ruby>Self-draw<rt>自摸</rt></ruby></button>
            <button disabled id="m6" onclick="MoveButton(6)" style="left: 75.5005%; bottom: 0.2145%;">Cancel</button>
        </div>
        <!-- <div class="sq" data-val="0"></div> -->
        <div id="pfulu" style="position: absolute; left: 50%; top: 91.5%; width: 4.21875%; height: 37.5%; transform-origin: 50% 10%; transform: rotate(270deg);"></div>
        <div id="pdraw" data-mov="0" style="position: absolute; top: 84%; width: 8.4375%; height: 15%; transform: rotate(270deg); overflow: visible;"></div> 
        <div id="phand" style="position: absolute; left: 15%; top: 84%; width: 8.4375%; height: 60%; transform-origin: 50% 12.5%; transform: rotate(270deg); overflow: visible;"></div>
        <div class="ohand" id="hand1" style="position: absolute; right: 1%; bottom: 36%; width: 4.21875%; height: 30%; transform: rotate(180deg);"></div>
        <div class="ofulu" id="fulu1" style="position: absolute; right: 1%; bottom: 58.5%; width: 4.21875%; height: 37.5%; transform: rotate(180deg);"></div>
        <div class="odraw" data-mov="0" id="draw1" style="position: absolute; right: 1%; width: 4.21875%; height: 7.5%; transform: rotate(270deg);"></div>
        <div class="ohand" id="hand2" style="position: absolute; right: 24%; top: 1%; width: 4.21875%; height: 30%; transform-origin: 50% 12.5%; transform: rotate(90deg);"></div>
        <div class="ofulu" id="fulu2" style="position: absolute; right: 36.65625%; top: 1%; width: 4.21875%; height: 37.5%; transform-origin: 50% 10%; transform: rotate(90deg);"></div>
        <div class="odraw" data-mov="0" id="draw2" style="position: absolute; top: 1%; width: 4.21875%; height: 7.5%; transform: rotate(180deg);"></div>
        <div class="ohand" id="hand3" style="position: absolute; left: 1%; top: 26%; width: 4.21875%; height: 30%;"></div>
        <div class="ofulu" id="fulu3" style="position: absolute; left: 1%; top: 48.5%; width: 4.21875%; height: 37.5%;"></div>
        <div class="odraw" data-mov="0" id="draw3" style="position: absolute; left: 1%; width: 4.21875%; height: 7.5%; transform: rotate(90deg);"></div>
    </div>
    <div id="settings">
        <div id="setbut" onclick="Openbg()" style="position: absolute; right: 0.002rem; bottom: 0.002rem; width: 5.625%; height: 10%; background-size: 100% 100%; background-image: url('images/settings.svg');"></div>
        <div id="setbg" style="visibility: hidden; position: absolute; width: 100%; height: 100%; background: rgba(0,0,0,0.3);">
        <div style="position: absolute; width: 80%; height: 80%; left: 10%; top: 10%; background-color: #018034; border: 0.0032rem solid #000;">
            <p style="font-size: 0.04rem; position: absolute; left: 7.5%; top: 0;">Volume🔊</p>
            <p style="font-size: 0.032rem; position: absolute; left: 12%; top: calc(0.25% + 0.044rem);">BGM</p>
            <input id="sldbgm" type="range" min="0" max="100" value="90" oninput="Volbgmchange()" style="top: calc(0.25% + 0.057rem);">
            <p id="tvbgm" style="font-size: 0.032rem; position: absolute; left: 80%; top: calc(0.25% + 0.044rem);">90</p>
            <p style="font-size: 0.032rem; position: absolute; left: 12%; top: calc(0.25% + 0.0792rem);">SFX</p>
            <input id="sldsfx" type="range" min="0" max="100" value="90" oninput="Volsfxchange()" style="top: calc(0.25% + 0.0922rem);">
            <p id="tvsfx" style="font-size: 0.032rem; position: absolute; left: 80%; top: calc(0.25% + 0.0792rem);">90</p>
            <p style="font-size: 0.04rem; position: absolute; left: 7.5%; bottom: 2%;">
                <a href="https://github.com/Yowwowwow/nang-yen-lyy-chiweg" target="_blank">How to play?</a>&nbsp;&nbsp;
                <a href="https://yowwowwow.github.io/nang-yen-lyy-chiweg/Lore" target="_blank">Lore</a>
            </p>
            <div id="closesetbut" onclick="Closebg()" style="position: absolute; right: 0.0015rem; top: 0.0015rem; width: 4.21875%; height: 7.5%; background-size: 100% 100%; background-image: url('images/cross.svg');"></div>
        </div>
        </div>
    </div>
    <div id="confirmquit">
    <div id="cnfbg" style="visibility: hidden; position: absolute; width: 100%; height: 100%; background: rgba(0,0,0,0.3);">
        <div style="position: absolute; width: 80%; height: 80%; left: 10%; top: 10%; background-color: #018034; border: 0.0032rem solid #000;">
            <p style="font-size: 0.05rem; position: absolute; width: 100%; height: 30%; left: 0; top: 25%; text-align: center;">Quit and return to main menu?</p>
            <button onclick="RealQUIT()" style="position: absolute; left: 12%; bottom: 18%; width: 30%; height: 18%; font-size: 0.04rem;">YES✔️</button>
            <button onclick="DontQUIT()" style="position: absolute; right: 12%; bottom: 18%; width: 30%; height: 18%; font-size: 0.04rem;">NO❌</button>
        </div>
    </div>
    </div>
    <div id="cover" style="visibility: hidden; position: absolute; width: 100%; height: 100%; background: #016529;"></div>
</div>
</body>
<script> //Initialization
    var timeoutstoclear = [];
    function ttc(f,t){timeoutstoclear.push(setTimeout(f,t));}
    const title = document.getElementById("title");
    const game = document.getElementById("game");
    const confirmquit = document.getElementById("cnfbg");
    const cover = document.getElementById("cover");
    const disps = [document.getElementById("cd0"), document.getElementById("cd1"), document.getElementById("cd2"), document.getElementById("cd3")];
    const boxes = [document.getElementById("cb0"), document.getElementById("cb1"), document.getElementById("cb2"), document.getElementById("cb3")];
    const pdisp = document.getElementById("playercount");
    const field = document.getElementById("field");
    const fdpcs = field.children; //field pieces
    const heads = [document.getElementById("phead"), document.getElementById("head1"), document.getElementById("head2"), document.getElementById("head3")];
    const winds = [document.getElementById("pwind"), document.getElementById("wind1"), document.getElementById("wind2"), document.getElementById("wind3")];
    const infostr = document.getElementById("infostr");
    const scores = [document.getElementById("pscore"), document.getElementById("score1"), document.getElementById("score2"), document.getElementById("score3")];
    const moves = [document.getElementById("m0"), document.getElementById("m1"), document.getElementById("m2"), document.getElementById("m3"), document.getElementById("m4"), document.getElementById("m5"), document.getElementById("m6")];
    const mvchi=0, mvpon=1, mvkan=2, mvrii=3, mvron=4, mvtsm=5, mvcan=6;
    const hands = [document.getElementById("phand"), document.getElementById("hand1"), document.getElementById("hand2"), document.getElementById("hand3")];
    const fulus = [document.getElementById("pfulu"), document.getElementById("fulu1"), document.getElementById("fulu2"), document.getElementById("fulu3")];
    const draws = [document.getElementById("pdraw"), document.getElementById("draw1"), document.getElementById("draw2"), document.getElementById("draw3")];
    const headarr = ['<img src="images/puan head.svg">', '<img src="images/chyung head.svg">', '<img src="images/zra head.svg">', '<img src="images/cnai head.svg">'];
    const windarr = ['<ruby style="color: #faa">東<rt>east</rt></ruby>', "<ruby>南<rt>south</rt></ruby>", "<ruby>西<rt>west</rt></ruby>", "<ruby>北<rt>north</rt></ruby>"];
    const gamewind = [['<ruby>東<rt>east</rt></ruby>1','<ruby>東<rt>east</rt></ruby>2','<ruby>東<rt>east</rt></ruby>3','<ruby>東<rt>east</rt></ruby>4'],['<ruby>南<rt>east</rt></ruby>1','<ruby>南<rt>east</rt></ruby>2','<ruby>南<rt>east</rt></ruby>3','<ruby>南<rt>east</rt></ruby>4'],['<ruby>西<rt>east</rt></ruby>1','<ruby>西<rt>east</rt></ruby>2','<ruby>西<rt>east</rt></ruby>3','<ruby>西<rt>east</rt></ruby>4'],['<ruby>北<rt>east</rt></ruby>1','<ruby>北<rt>east</rt></ruby>2','<ruby>北<rt>east</rt></ruby>3','<ruby>北<rt>east</rt></ruby>4']];
    function InfoStr(a,b,c,d){return gamewind[a][b]+`<ruby>連<rt>streak</rt>${c}<ruby>流<rt>draws</rt>${d}`;}
    const noredwindarr = ['<ruby>東<rt>east</rt></ruby>', "<ruby>南<rt>south</rt></ruby>", "<ruby>西<rt>west</rt></ruby>", "<ruby>北<rt>north</rt></ruby>"];
    const allredwinarr = ['<ruby style="color: #faa">東<rt>east</rt></ruby>', '<ruby style="color: #faa">南<rt>south</rt></ruby>', '<ruby style="color: #faa">西<rt>west</rt></ruby>', '<ruby style="color: #faa">北<rt>north</rt></ruby>'];
    const scorearr = [120000, 60000, 40000, 30000];
    function Randint(max,min=0){let a=max-min;b=min;if(a<0){a*=-1;b=max;}return b+Math.floor(Math.random()*a);}
    function CryRandint(max,min=0){let a=max-min;b=min;if(a<0){a*=-1;b=max;}const c=new Uint32Array(1);crypto.getRandomValues(c);return c[0]%a+b;}
    //max is non-inclusive
    function PieceOf(val, ori=-1){return `<div class="sq" data-val="${val}"${ori>=0?' data-ori="'+ori+'"':''}></div>`;} //-2: empty; -1: back; 0: shuai; 10: jiang
    function SetField(pos,val=-3,ori=-1){if(val!=-3)fdpcs[pos].dataset.val=val;if(ori!=-1)fdpcs[pos].dataset.ori=ori;}
    var charord; //character order, [0]=east [1]=south... 0=puan 1=chyung 2=zra 3=cnai
    var charpos; //use this for wind to on-screen position convertion [0]=east... 0=bottom, 1=right, 2=top, 3=left
    var pchar;
    var pwind;
    var pscore;
    var pnum; //number of players
    var gwind = [0, 0]; //current game wind, [0]=orientation, [1]=number
    var streak; //liyen2 drruang1 count
    var goulash; //liou2 jyu2 count
    var mtn; //mountain (pai shan)
    var srrou; //players' actual hands (srrou for srrou3 pai2)
    var mingp; //ming2(revealed) pai2. players' fulu's
    var jin; //jin4 drrang1 of the turn player
    var turnp; //turn player
</script>
<script src="scripts/CharacterSelect.js"></script>
<script src="scripts/Settings.js"></script>
<script src="scripts/GameManager.js"></script>
<script>
    //cover.style.visibility = "hidden";
    function START(){
        title.style.visibility = "hidden";
        cover.style.visibility = "visible";
        SaveChars();
        Start2();
    }
    function Start2(){
        let charinfo = WhoPlays();
        pchar = charinfo[0];
        charord = [];
        for(let i=0;charinfo[1].length>0;i++){
            let t = Randint(charinfo[1].length);
            charord.push(charinfo[1][t]);
            if(charord[i]==pchar)pwind=i;
            charinfo[1].splice(t, 1);
        }
        heads[0].innerHTML = headarr[pchar];
        winds[0].innerHTML = windarr[pwind];
        scores[0].innerHTML = scorearr[charord.length-1];
        for(let i=1;i<4;i++){ //set heads, winds, scores, hands, draws, fulus
            if(charord.length==1 || (charord.length==2 && i%2==1) || (charord.length==3 && i+pwind==3)){
                heads[i].style.visibility = "hidden";
                winds[i].style.visibility = "hidden";
                scores[i].style.visibility = "hidden";
                hands[i].style.visibility = "hidden";
                draws[i].style.visibility = "hidden";
                fulus[i].style.visibility = "hidden";
            }
            else{
                heads[i].style.removeProperty("visibility");
                winds[i].style.removeProperty("visibility");
                scores[i].style.removeProperty("visibility");
                hands[i].style.removeProperty("visibility");
                draws[i].style.removeProperty("visibility");
                fulus[i].style.removeProperty("visibility");
                if(charord.length==2){
                    heads[i].innerHTML = headarr[charord[(pwind+1)%2]];
                    winds[i].innerHTML = windarr[(pwind+1)%2];
                }
                else{
                    heads[i].innerHTML = headarr[charord[(pwind+i)%4]];
                    winds[i].innerHTML = windarr[(pwind+i)%4];
                }
                scores[i].innerHTML = scorearr[charord.length-1];
            }
        }
        pnum = charord.length;
        srrou=[]; for(let i=0;i<pnum;i++)srrou.push([]);
        mingp=[]; for(let i=0;i<pnum;i++)mingp.push([]);
        charpos=[]; for(let i=0;i<pnum;i++)charpos.push(-1);
        for(let i=0;i<pnum;i++)for(let j=0;j<4;j++)if(winds[j].style.visibility!=="hidden"&&winds[j].innerHTML===windarr[i])charpos[i]=j;
        gwind = [0, 0]; streak = 0; goulash = 0;
        game.style.visibility = "visible";
        cover.style.visibility= "hidden";
        GMNGStartRound();
    }
    function QUIT(){
       confirmquit.style.visibility = "visible";
    }
    function RealQUIT(){
        confirmquit.style.visibility = "hidden";
        game.style.visibility = "hidden";
        for(let i=0;i<timeoutstoclear.length;i++)clearTimeout(timeoutstoclear[i]);
        timeoutstoclear = [];
        title.style.visibility = "visible";
    }
    function DontQUIT(){
       confirmquit.style.visibility = "hidden";
    }
</script>
<!-- <script src="scripts/BoxTurner.js"></script> -->
</html>
